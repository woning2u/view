<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>뷰델카라반펜션 예약현황</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
  line-height: 1.6;
}
h1 {
  margin-bottom: 10px;
}
.control-buttons {
  margin-bottom: 20px;
}
.control-buttons button {
  padding: 8px 16px;
  border-radius: 10px;
  border: 1px solid #555;
  cursor: pointer;
  margin-right: 10px;
}
.zone-selector {
  margin-bottom: 20px;
  padding: 15px;
  background: #f0f0f0;
  border-radius: 10px;
}
.zone-selector button {
  padding: 10px 20px;
  border-radius: 8px;
  border: 1px solid #555;
  cursor: pointer;
  font-size: 14px;
  margin-right: 10px;
  margin-bottom: 10px;
}
.selected-zone {
  background-color: #2196f3 !important;
  color: white !important;
}
.action-buttons {
  margin-bottom: 20px;
}
.action-buttons button {
  padding: 10px 20px;
  border-radius: 8px;
  border: 1px solid #555;
  cursor: pointer;
  font-size: 14px;
  margin-right: 10px;
}
.zone-title {
  margin: 10px 0 5px 0;
  font-weight: bold;
  display: block;
  font-size: 18px;
}
.zone-row {
  margin-bottom: 15px;
}
.spot-btn {
  padding: 10px 20px;
  margin: 4px;
  border-radius: 10px;
  border: 2px solid #7d6be8;
  cursor: pointer;
  background-color: #f5f2ff;
  font-size: 14px;
  font-weight: bold;
  min-width: 75px;
  min-height: 30px;
}
.on {
  background-color: #4caf50;
  color: #fff;
}
.mode-on {
  background-color: #ff9800;
  color: #fff;
}
.zone-reset-btn {
  background-color: #f44336;
  color: white;
}
.zone-on-btn {
  background-color: #4caf50;
  color: white;
}
</style>
</head>
<body>
<h1>뷰델카라반펜션 예약현황</h1>

<div class="control-buttons">
  <button onclick="resetAll()">전체 초기화</button>
  <button onclick="setAll(true)">전부 켜기</button>
  <button onclick="setAll(false)">전부 끄기</button>
</div>

<!-- 구역 선택 버튼들 -->
<div class="zone-selector">
  <div><strong>구역 선택:</strong></div>
  <div id="zoneButtons"></div>
</div>

<!-- 액션 버튼들 -->
<div class="action-buttons">
  <button id="actionReset" onclick="performAction('reset')">초기화</button>
  <button id="actionOn" onclick="performAction('on')">켜기</button>
  <button id="actionNoGuest" onclick="performAction('noGuest')">손님없음</button>
</div>

<div id="zones"></div>

<script>
const zoneData = {
  "A": 6,
  "B": 3,
  "C": 8,
  "D": 3,
  "E": 9
};

const saved = JSON.parse(localStorage.getItem("reservationStatus") || "{}");
let selectedZone = null;
const zoneNoGuestMode = {};

function createZoneButtons() {
  const container = document.getElementById("zoneButtons");
  container.innerHTML = "";
  
  Object.keys(zoneData).forEach(zone => {
    const btn = document.createElement("button");
    btn.textContent = `${zone}구역`;
    btn.onclick = () => selectZone(zone, btn);
    container.appendChild(btn);
  });
}

function selectZone(zone, btn) {
  // 모든 버튼 초기화
  document.querySelectorAll('#zoneButtons button').forEach(b => {
    b.classList.remove('selected-zone');
  });
  
  // 선택된 버튼 하이라이트
  btn.classList.add('selected-zone');
  selectedZone = zone;
}

function performAction(action) {
  if (!selectedZone) {
    alert('구역을 먼저 선택해주세요!');
    return;
  }
  
  switch(action) {
    case 'reset':
      resetZone(selectedZone);
      break;
    case 'on':
      setZoneOn(selectedZone);
      break;
    case 'noGuest':
      toggleZoneNoGuest(selectedZone);
      break;
  }
}

function createZones() {
  const container = document.getElementById("zones");
  container.innerHTML = "";

  Object.keys(zoneData).forEach(zone => {
    const count = zoneData[zone];
    const zoneDiv = document.createElement("div");
    zoneDiv.className = "zone-row";

    const title = document.createElement("div");
    title.className = "zone-title";
    title.textContent = `${zone}구역`;
    zoneDiv.appendChild(title);

    for (let i = 1; i <= count; i++) {
      const key = `${zone}${i}`;
      const btn = document.createElement("button");
      btn.className = "spot-btn";

      const state = saved[key] || {};
      const isOn = !!state.on;
      const isNoGuest = !!state.noGuest;

      btn.textContent = isNoGuest ? "손님없음" : key;

      if (isOn) btn.classList.add("on");
      if (isNoGuest) btn.dataset.noGuest = "true";

      btn.onclick = () => toggleStatus(btn, key, zone);
      zoneDiv.appendChild(btn);
    }

    container.appendChild(zoneDiv);
  });
}

function resetZone(zone) {
  const count = zoneData[zone];
  for (let i = 1; i <= count; i++) {
    const key = `${zone}${i}`;
    delete saved[key];
  }
  delete zoneNoGuestMode[zone];
  localStorage.setItem("reservationStatus", JSON.stringify(saved));
  createZones();
}

function setZoneOn(zone) {
  const count = zoneData[zone];
  let allOn = true;
  for (let i = 1; i <= count; i++) {
    const state = saved[`${zone}${i}`] || {};
    if (!state.on) {
      allOn = false;
      break;
    }
  }
  
  for (let i = 1; i <= count; i++) {
    const key = `${zone}${i}`;
    const prev = saved[key] || { on: false, noGuest: false };
    prev.on = !allOn;
    prev.noGuest = false;
    saved[key] = prev;
  }
  localStorage.setItem("reservationStatus", JSON.stringify(saved));
  createZones();
}

function toggleStatus(btn, key, zone) {
  const state = saved[key] || { on: false, noGuest: false };

  if (zoneNoGuestMode[zone] && !state.on) {
    const nowNoGuest = !state.noGuest;
    state.noGuest = nowNoGuest;

    if (nowNoGuest) {
      btn.textContent = "손님없음";
      btn.dataset.noGuest = "true";
    } else {
      btn.textContent = key;
      delete btn.dataset.noGuest;
    }
  } else if (!zoneNoGuestMode[zone]) {
    btn.classList.toggle("on");
    state.on = btn.classList.contains("on");
  }

  saved[key] = state;
  localStorage.setItem("reservationStatus", JSON.stringify(saved));
}

function toggleZoneNoGuest(zone) {
  const newState = !zoneNoGuestMode[zone];
  zoneNoGuestMode[zone] = newState;

  const count = zoneData[zone];
  for (let i = 1; i <= count; i++) {
    const key = `${zone}${i}`;
    const prev = saved[key] || { on: false, noGuest: false };
    if (!prev.on) {
      prev.noGuest = newState;
    }
    saved[key] = prev;
  }
  localStorage.setItem("reservationStatus", JSON.stringify(saved));
  createZones();
}

function setAll(state) {
  Object.keys(zoneData).forEach(zone => {
    const count = zoneData[zone];
    for (let i = 1; i <= count; i++) {
      const key = `${zone}${i}`;
      const prev = saved[key] || { on: false, noGuest: false };
      prev.on = state;
      saved[key] = prev;
    }
  });
  localStorage.setItem("reservationStatus", JSON.stringify(saved));
  createZones();
}

function resetAll() {
  localStorage.removeItem("reservationStatus");
  Object.keys(saved).forEach(key => delete saved[key]);
  Object.keys(zoneNoGuestMode).forEach(zone => delete zoneNoGuestMode[zone]);
  selectedZone = null;
  document.querySelectorAll('#zoneButtons button').forEach(b => {
    b.classList.remove('selected-zone');
  });
  createZones();
}

// 초기화
createZoneButtons();
createZones();
</script>
</body>
</html>

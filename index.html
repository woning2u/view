<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>뷰델카라반펜션 예약현황판</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
  line-height: 1.6;
  display: flex;
  flex-direction: row;
  gap: 40px;
}
.main-content {
  flex: 1;
}
#exitLog {
  width: 280px;
  border: 2px solid #ff9800;
  border-radius: 10px;
  padding: 10px 15px;
  background: #fffaf2;
  font-size: 14px;
  height: fit-content;
}
#exitLog h2 {
  margin-top: 0;
  font-size: 16px;
  color: #ff9800;
  text-align: center;
}
.exit-item {
  background: #fff3e0;
  border: 1px solid #ffc107;
  border-radius: 6px;
  padding: 6px 10px;
  margin-bottom: 6px;
}
.header {
  display: flex;
  align-items: center;
  margin-bottom: 20px;
  gap: 15px;
}
h1 {
  margin: 0;
}
button:disabled {
  cursor: not-allowed;
  opacity: 0.6;
}
.control-buttons button {
  padding: 8px 16px;
  border-radius: 10px;
  border: 1px solid #555;
  cursor: pointer;
  background: #f44336;
  color: white;
}
#readOnlySwitch {
  padding: 8px 16px;
  border-radius: 10px;
  border: 1px solid #555;
  cursor: pointer;
  background: #555;
  color: white;
}
#readOnlySwitch.active {
  background: #2196f3;
}
#langSwitch {
  padding: 8px 16px;
  border-radius: 10px;
  border: 1px solid #555;
  cursor: pointer;
  background: #ffc107;
  color: #333;
}
.zone-selector {
  margin-bottom: 20px;
  padding: 15px;
  background: #f0f0f0;
  border-radius: 10px;
}
.zone-selector button {
  padding: 10px 20px;
  border-radius: 8px;
  border: 1px solid #555;
  cursor: pointer;
  font-size: 14px;
  margin-right: 10px;
  margin-bottom: 10px;
}
.selected-zone {
  background-color: #2196f3 !important;
  color: white !important;
}
.action-buttons {
  margin-bottom: 20px;
}
.action-buttons button {
  padding: 10px 20px;
  border-radius: 8px;
  border: 1px solid #555;
  cursor: pointer;
  font-size: 14px;
  margin-right: 10px;
  background-color: #f0f0f0;
  color: #333;
}
.action-buttons button:hover:not(:disabled) {
  background-color: #ddd;
}
#actionNoGuest.active {
  background-color: #ff9800 !important;
  color: white !important;
  border-color: #f57c00 !important;
}
.zone-title {
  margin: 10px 0 5px 0;
  font-weight: bold;
  display: block;
  font-size: 18px;
}
.zone-row {
  margin-bottom: 15px;
}
.spot-btn {
  padding: 10px 20px;
  margin: 4px;
  border-radius: 10px;
  border: 2px solid #7d6be8;
  cursor: pointer;
  font-size: 14px;
  font-weight: bold;
  min-width: 75px;
  min-height: 45px;
  transition: all 0.2s;
  position: relative;
  white-space: nowrap;
}
.spot-btn.init {
  background-color: #f5f2ff;
  color: #333;
}
.spot-btn.on {
  background-color: #4caf50;
  color: #fff;
}
.spot-btn.exit {
  background-color: #fff5cc;
  color: #333;
  border: 2px solid #ffeb3b;
}
.spot-btn.exit .exit-label {
  display: block;
  font-size: 11px;
  color: #ff9800;
  position: absolute;
  bottom: 3px;
  left: 50%;
  transform: translateX(-50%);
}
.spot-btn.no-guest {
  background-color: #f0f0f0;
  color: #555;
  font-size: 12px;
}
.zone-reset-btn {
  background-color: #f44336;
  color: white;
}
</style>
</head>
<body>

<div class="main-content">
  <div class="header">
    <button id="readOnlySwitch" onclick="toggleReadOnly()">읽기전용: OFF</button>
    <h1 id="mainTitle">뷰델카라반펜션 예약현황판</h1>
    <button onclick="resetAll()" class="control-buttons" id="resetAllBtn">전체 초기화</button>
    <button id="langSwitch" onclick="toggleLanguage()">ภาษาไทย</button>
  </div>

  <div class="zone-selector">
    <div><strong id="zoneSelectLabel">구역 선택:</strong></div>
    <div id="zoneButtons"></div>
  </div>

  <div class="action-buttons">
    <button id="actionReset" onclick="performAction('reset')" class="zone-reset-btn">초기화</button>
    <button id="actionOn" onclick="performAction('on')">켜기</button>
    <button id="actionNoGuest" onclick="toggleNoGuestMode()">손님없음</button>
  </div>

  <div id="zones"></div>
</div>

<div id="exitLog">
  <h2 id="exitTitle">퇴실 현황</h2>
  <div id="exitList"></div>
</div>

<script>
const zoneData = { "A": 6, "B": 3, "C": 8, "D": 3, "E": 9 };
const saved = JSON.parse(localStorage.getItem("reservationStatus") || "{}");
let selectedZone = null;
let readOnlyMode = false;
let singleNoGuestMode = false;
let language = localStorage.getItem("language") || "ko";

const texts = {
  ko: {
    title: "뷰델카라반펜션 예약현황판",
    readOnlyOn: "읽기전용: ON",
    readOnlyOff: "읽기전용: OFF",
    resetAll: "전체 초기화",
    zoneSelect: "구역 선택:",
    reset: "초기화",
    on: "켜기",
    noGuest: "손님없음",
    exitTitle: "퇴실 현황",
    exitMsg: (name) => `${name} 구역이 퇴실했습니다.`,
    exitLabel: "퇴실",
  },
  th: {
    // "뷰델카라반펜션" 부분은 번역되지 않도록 유지
    title: "กระดานสถานะการจอง 뷰델카라반펜션",
    readOnlyOn: "โหมดอ่านอย่างเดียว: เปิด",
    readOnlyOff: "โหมดอ่านอย่างเดียว: ปิด",
    resetAll: "รีเซ็ตทั้งหมด",
    zoneSelect: "เลือกโซน:",
    reset: "รีเซ็ต",
    on: "เปิด",
    noGuest: "ไม่มีลูกค้า",
    exitTitle: "สถานะการเช็กเอาต์",
    exitMsg: (name) => `โซน ${name} ได้เช็กเอาต์แล้ว`,
    exitLabel: "เช็กเอาต์",
  }
};

function applyLanguage() {
  const t = texts[language];
  document.getElementById("mainTitle").textContent = t.title;
  document.getElementById("readOnlySwitch").textContent = readOnlyMode ? t.readOnlyOn : t.readOnlyOff;
  document.getElementById("resetAllBtn").textContent = t.resetAll;
  document.getElementById("zoneSelectLabel").textContent = t.zoneSelect;
  document.getElementById("actionReset").textContent = t.reset;
  document.getElementById("actionOn").textContent = t.on;
  document.getElementById("actionNoGuest").textContent = t.noGuest;
  document.getElementById("exitTitle").textContent = t.exitTitle;
  document.getElementById("langSwitch").textContent = language === "ko" ? "ภาษาไทย" : "한국어";
  updateExitLog();
}

function toggleLanguage() {
  language = language === "ko" ? "th" : "ko";
  localStorage.setItem("language", language);
  applyLanguage();
}

function toggleReadOnly() {
  readOnlyMode = !readOnlyMode;
  const btn = document.getElementById("readOnlySwitch");
  const t = texts[language];
  if (readOnlyMode) {
    btn.textContent = t.readOnlyOn;
    btn.classList.add("active");
    setAllButtonsDisabled(true);
  } else {
    btn.textContent = t.readOnlyOff;
    btn.classList.remove("active");
    setAllButtonsDisabled(false);
  }
}

function setAllButtonsDisabled(state) {
  const buttons = document.querySelectorAll("button:not(#readOnlySwitch):not(#langSwitch)");
  buttons.forEach(b => b.disabled = state);
}

function formatDisplayName(key) {
  const match = key.match(/^([A-Z]+)(\d+)$/);
  return match ? `${match[1]}-${match[2]}` : key;
}

function createZoneButtons() {
  const container = document.getElementById("zoneButtons");
  container.innerHTML = "";
  Object.keys(zoneData).forEach(zone => {
    const btn = document.createElement("button");
    btn.textContent = `${zone}구역`;
    btn.onclick = () => toggleZoneSelect(zone, btn);
    container.appendChild(btn);
  });
}

function toggleZoneSelect(zone, btn) {
  if (readOnlyMode) return;
  if (selectedZone === zone) {
    selectedZone = null;
    btn.classList.remove('selected-zone');
  } else {
    document.querySelectorAll('#zoneButtons button').forEach(b => b.classList.remove('selected-zone'));
    btn.classList.add('selected-zone');
    selectedZone = zone;
  }
}

function performAction(action) {
  if (readOnlyMode) return;
  if (!selectedZone) return alert(language === "ko" ? '구역을 먼저 선택해주세요!' : 'กรุณาเลือกโซนก่อน!');
  if (action === "reset") resetZone(selectedZone);
  else if (action === "on") toggleZoneOn(selectedZone);
}

function toggleNoGuestMode() {
  singleNoGuestMode = !singleNoGuestMode;
  const btn = document.getElementById("actionNoGuest");
  if (singleNoGuestMode) btn.classList.add("active");
  else btn.classList.remove("active");
}

function cycleSpotStatus(key, btn, zone) {
  if (readOnlyMode) return;
  if (singleNoGuestMode) {
    saved[key] = { status: 'no-guest' };
    updateButtonUI(btn, key, 'no-guest');
  } else {
    const state = saved[key] || { status: 'init' };
    let nextStatus;
    switch(state.status) {
      case 'init': nextStatus = 'on'; break;
      case 'on': nextStatus = 'exit'; break;
      case 'exit': nextStatus = 'init'; break;
      default: nextStatus = 'init'; break;
    }
    saved[key] = { status: nextStatus };
    updateButtonUI(btn, key, nextStatus);
  }
  updateExitLog();
  localStorage.setItem("reservationStatus", JSON.stringify(saved));
}

function updateButtonUI(btn, key, status) {
  btn.className = `spot-btn ${status}`;
  btn.innerHTML = "";
  const t = texts[language];
  if (status === 'exit') {
    const main = document.createElement("div");
    main.textContent = formatDisplayName(key);
    const label = document.createElement("div");
    label.className = "exit-label";
    label.textContent = t.exitLabel;
    btn.appendChild(main);
    btn.appendChild(label);
  } else if (status === 'no-guest') {
    btn.textContent = t.noGuest;
  } else {
    btn.textContent = formatDisplayName(key);
  }
}

function createZones() {
  const container = document.getElementById("zones");
  container.innerHTML = "";
  Object.keys(zoneData).forEach(zone => {
    const count = zoneData[zone];
    const zoneDiv = document.createElement("div");
    zoneDiv.className = "zone-row";
    const title = document.createElement("div");
    title.className = "zone-title";
    title.textContent = `${zone}구역`;
    zoneDiv.appendChild(title);
    for (let i = 1; i <= count; i++) {
      const key = `${zone}${i}`;
      const state = saved[key] || { status: 'init' };
      const btn = document.createElement("button");
      updateButtonUI(btn, key, state.status || 'init');
      btn.onclick = () => cycleSpotStatus(key, btn, zone);
      zoneDiv.appendChild(btn);
    }
    container.appendChild(zoneDiv);
  });
  updateExitLog();
}

function updateExitLog() {
  const exitList = document.getElementById("exitList");
  const t = texts[language];
  exitList.innerHTML = "";
  Object.entries(saved).forEach(([key, val]) => {
    if (val.status === "exit") {
      const item = document.createElement("div");
      item.className = "exit-item";
      item.textContent = t.exitMsg(formatDisplayName(key));
      exitList.appendChild(item);
    }
  });
}

function toggleZoneOn(zone) {
  const count = zoneData[zone];
  let turnOn = false;
  for (let i = 1; i <= count; i++) {
    if (!saved[`${zone}${i}`] || saved[`${zone}${i}`].status !== 'on') { turnOn = true; break; }
  }
  const targetStatus = turnOn ? 'on' : 'init';
  for (let i = 1; i <= count; i++) saved[`${zone}${i}`] = { status: targetStatus };
  localStorage.setItem("reservationStatus", JSON.stringify(saved));
  createZones();
}

function resetZone(zone) {
  const count = zoneData[zone];
  for (let i = 1; i <= count; i++) delete saved[`${zone}${i}`];
  localStorage.setItem("reservationStatus", JSON.stringify(saved));
  createZones();
}

function resetAll() {
  if (readOnlyMode) return;
  localStorage.removeItem("reservationStatus");
  Object.keys(saved).forEach(k => delete saved[k]);
  selectedZone = null;
  singleNoGuestMode = false;
  document.getElementById("actionNoGuest").classList.remove("active");
  createZones();
}

createZoneButtons();
createZones();
applyLanguage();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>뷰델카라반펜션 예약현황</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
  line-height: 1.6;
}
.header {
  display: flex;
  align-items: center;
  margin-bottom: 20px;
  gap: 15px;
}
h1 {
  margin: 0;
}
.control-buttons button {
  padding: 8px 16px;
  border-radius: 10px;
  border: 1px solid #555;
  cursor: pointer;
  background: #f44336;
  color: white;
}
.zone-selector {
  margin-bottom: 20px;
  padding: 15px;
  background: #f0f0f0;
  border-radius: 10px;
}
.zone-selector button {
  padding: 10px 20px;
  border-radius: 8px;
  border: 1px solid #555;
  cursor: pointer;
  font-size: 14px;
  margin-right: 10px;
  margin-bottom: 10px;
}
.selected-zone {
  background-color: #2196f3 !important;
  color: white !important;
}
.action-buttons {
  margin-bottom: 20px;
}
.action-buttons button {
  padding: 10px 20px;
  border-radius: 8px;
  border: 1px solid #555;
  cursor: pointer;
  font-size: 14px;
  margin-right: 10px;
}
.action-on.active {
  background-color: #4caf50;
  color: white;
}
.action-noguest.active {
  background-color: #ff9800;
  color: white;
}
.action-on.disabled {
  background-color: #ccc;
  color: #666;
  cursor: not-allowed;
}
.zone-title {
  margin: 10px 0 5px 0;
  font-weight: bold;
  display: block;
  font-size: 18px;
}
.zone-row {
  margin-bottom: 15px;
}
.spot-btn {
  padding: 10px 20px;
  margin: 4px;
  border-radius: 10px;
  border: 2px solid #7d6be8;
  cursor: pointer;
  font-size: 14px;
  font-weight: bold;
  min-width: 75px;
  min-height: 30px;
  transition: all 0.2s;
}
/* 초기 상태 */
.spot-btn.init {
  background-color: #f5f2ff;
  color: #333;
}
/* 켜기 상태 */
.spot-btn.on {
  background-color: #4caf50;
  color: #fff;
}
/* 손님없음 상태 */
.spot-btn.no-guest {
  background-color: #f5f2ff;
  color: #333;
}
.zone-reset-btn {
  background-color: #f44336;
  color: white;
}
</style>
</head>
<body>
<div class="header">
  <h1>뷰델카라반펜션 예약현황</h1>
  <button onclick="resetAll()" class="control-buttons">전체 초기화</button>
</div>

<!-- 구역 선택 버튼들 -->
<div class="zone-selector">
  <div><strong>구역 선택:</strong></div>
  <div id="zoneButtons"></div>
</div>

<!-- 액션 버튼들 -->
<div class="action-buttons">
  <button id="actionReset" onclick="performAction('reset')" class="zone-reset-btn">초기화</button>
  <button id="actionOn" onclick="performAction('on')">켜기</button>
  <button id="actionNoGuest" onclick="performAction('noGuest')">손님없음</button>
</div>

<div id="zones"></div>

<script>
const zoneData = {
  "A": 6,
  "B": 3,
  "C": 8,
  "D": 3,
  "E": 9
};

const saved = JSON.parse(localStorage.getItem("reservationStatus") || "{}");
let selectedZone = null;
const zoneNoGuestMode = {};

function createZoneButtons() {
  const container = document.getElementById("zoneButtons");
  container.innerHTML = "";
  
  Object.keys(zoneData).forEach(zone => {
    const btn = document.createElement("button");
    btn.textContent = `${zone}구역`;
    btn.onclick = () => toggleZoneSelect(zone, btn);
    container.appendChild(btn);
  });
  
  updateActionButtons();
}

function toggleZoneSelect(zone, btn) {
  if (selectedZone === zone) {
    selectedZone = null;
    btn.classList.remove('selected-zone');
  } else {
    document.querySelectorAll('#zoneButtons button').forEach(b => {
      b.classList.remove('selected-zone');
    });
    btn.classList.add('selected-zone');
    selectedZone = zone;
  }
  updateActionButtons();
}

function updateActionButtons() {
  const actionOnBtn = document.getElementById('actionOn');
  const actionNoGuestBtn = document.getElementById('actionNoGuest');
  
  if (!selectedZone) {
    actionOnBtn.textContent = '켜기';
    actionOnBtn.classList.remove('active', 'disabled');
    actionOnBtn.onclick = () => performAction('on');
    actionNoGuestBtn.classList.remove('active');
    return;
  }
  
  const isNoGuestMode = zoneNoGuestMode[selectedZone];
  
  const allOn = isZoneAllOn(selectedZone);
  if (allOn) {
    actionOnBtn.textContent = '끄기';
    actionOnBtn.classList.add('active');
  } else {
    actionOnBtn.textContent = '켜기';
    actionOnBtn.classList.remove('active');
  }
  
  if (isNoGuestMode) {
    actionOnBtn.classList.add('disabled');
    actionOnBtn.onclick = null;
  } else {
    actionOnBtn.classList.remove('disabled');
    actionOnBtn.onclick = () => performAction('on');
  }
  
  if (isNoGuestMode) {
    actionNoGuestBtn.classList.add('active');
  } else {
    actionNoGuestBtn.classList.remove('active');
  }
}

function isZoneAllOn(zone) {
  const count = zoneData[zone];
  for (let i = 1; i <= count; i++) {
    const state = saved[`${zone}${i}`] || { status: 'init' };
    if (state.status !== 'on') {
      return false;
    }
  }
  return true;
}

function performAction(action) {
  if (!selectedZone) {
    alert('구역을 먼저 선택해주세요!');
    return;
  }
  
  if (action === 'on' && zoneNoGuestMode[selectedZone]) {
    alert('손님없음 모드가 활성화되어 있습니다. 먼저 손님없음 버튼을 해제해주세요.');
    return;
  }
  
  switch(action) {
    case 'reset':
      resetZone(selectedZone);
      break;
    case 'on':
      toggleZoneOn(selectedZone);
      break;
    case 'noGuest':
      toggleZoneNoGuest(selectedZone);
      break;
  }
  updateActionButtons();
}

// 3단계 순환: init -> on -> no-guest -> init
function cycleSpotStatus(key, btn, zone) {
  const state = saved[key] || { status: 'init' };
  
  let nextStatus;
  switch(state.status) {
    case 'init':
      nextStatus = 'on';
      break;
    case 'on':
      nextStatus = 'no-guest';
      break;
    case 'no-guest':
      nextStatus = 'init';
      break;
    default:
      nextStatus = 'init';
  }
  
  // 상태 업데이트
  saved[key] = { status: nextStatus };
  
  // 버튼 UI 업데이트
  btn.className = `spot-btn ${nextStatus}`;
  if (nextStatus === 'init') {
    btn.textContent = key;
  } else if (nextStatus === 'on') {
    btn.textContent = key;
  } else {
    btn.textContent = '손님없음';
  }
  
  localStorage.setItem("reservationStatus", JSON.stringify(saved));
}

function createZones() {
  const container = document.getElementById("zones");
  container.innerHTML = "";

  Object.keys(zoneData).forEach(zone => {
    const count = zoneData[zone];
    const zoneDiv = document.createElement("div");
    zoneDiv.className = "zone-row";

    const title = document.createElement("div");
    title.className = "zone-title";
    title.textContent = `${zone}구역`;
    zoneDiv.appendChild(title);

    for (let i = 1; i <= count; i++) {
      const key = `${zone}${i}`;
      const btn = document.createElement("button");
      
      const state = saved[key] || { status: 'init' };
      const status = state.status || 'init';
      
      btn.className = `spot-btn ${status}`;
      btn.textContent = status === 'no-guest' ? '손님없음' : key;
      
      btn.onclick = () => cycleSpotStatus(key, btn, zone);
      zoneDiv.appendChild(btn);
    }

    container.appendChild(zoneDiv);
  });
  updateActionButtons();
}

function toggleZoneOn(zone) {
  const allOn = isZoneAllOn(zone);
  const targetStatus = allOn ? 'init' : 'on';
  
  const count = zoneData[zone];
  for (let i = 1; i <= count; i++) {
    const key = `${zone}${i}`;
    saved[key] = { status: targetStatus };
  }
  localStorage.setItem("reservationStatus", JSON.stringify(saved));
  createZones();
}

function resetZone(zone) {
  const count = zoneData[zone];
  for (let i = 1; i <= count; i++) {
    const key = `${zone}${i}`;
    delete saved[key];
  }
  delete zoneNoGuestMode[zone];
  localStorage.setItem("reservationStatus", JSON.stringify(saved));
  createZones();
}

function toggleZoneNoGuest(zone) {
  const newState = !zoneNoGuestMode[zone];
  zoneNoGuestMode[zone] = newState;

  const count = zoneData[zone];
  for (let i = 1; i <= count; i++) {
    const key = `${zone}${i}`;
    const prev = saved[key] || { status: 'init' };
    if (prev.status !== 'on') {
      prev.status = newState ? 'no-guest' : 'init';
    }
    saved[key] = prev;
  }
  localStorage.setItem("reservationStatus", JSON.stringify(saved));
  createZones();
}

function resetAll() {
  localStorage.removeItem("reservationStatus");
  Object.keys(saved).forEach(key => delete saved[key]);
  Object.keys(zoneNoGuestMode).forEach(zone => delete zoneNoGuestMode[zone]);
  selectedZone = null;
  document.querySelectorAll('#zoneButtons button').forEach(b => {
    b.classList.remove('selected-zone');
  });
  document.getElementById('actionOn').textContent = '켜기';
  document.getElementById('actionOn').classList.remove('active', 'disabled');
  document.getElementById('actionOn').onclick = () => performAction('on');
  document.getElementById('actionNoGuest').classList.remove('active');
  createZones();
}

// 초기화
createZoneButtons();
createZones();
</script>
</body>
</html>
